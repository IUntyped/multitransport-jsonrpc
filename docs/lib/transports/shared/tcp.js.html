<!DOCTYPE html><html><head><title>tcp.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../lib/client.js.html" class="source "><span class="base_path">lib / </span><span class="file_name">client.js</span></a><a href="../../../lib/index.js.html" class="source "><span class="base_path">lib / </span><span class="file_name">index.js</span></a><a href="../../../lib/server.js.html" class="source "><span class="base_path">lib / </span><span class="file_name">server.js</span></a><a href="../../../lib/transports/client/childProcess.js.html" class="source "><span class="base_path">lib / transports / client / </span><span class="file_name">childProcess.js</span></a><a href="../../../lib/transports/client/http.js.html" class="source "><span class="base_path">lib / transports / client / </span><span class="file_name">http.js</span></a><a href="../../../lib/transports/client/tcp.js.html" class="source "><span class="base_path">lib / transports / client / </span><span class="file_name">tcp.js</span></a><a href="../../../lib/transports/server/childProcess.js.html" class="source "><span class="base_path">lib / transports / server / </span><span class="file_name">childProcess.js</span></a><a href="../../../lib/transports/server/http.js.html" class="source "><span class="base_path">lib / transports / server / </span><span class="file_name">http.js</span></a><a href="../../../lib/transports/server/middleware.js.html" class="source "><span class="base_path">lib / transports / server / </span><span class="file_name">middleware.js</span></a><a href="../../../lib/transports/server/tcp.js.html" class="source "><span class="base_path">lib / transports / server / </span><span class="file_name">tcp.js</span></a><a href="../../../lib/transports/shared/loopback.js.html" class="source "><span class="base_path">lib / transports / shared / </span><span class="file_name">loopback.js</span></a><a href="../../../lib/transports/shared/tcp.js.html" class="source selected"><span class="base_path">lib / transports / shared / </span><span class="file_name">tcp.js</span></a><a href="../../../test/child/child.js.html" class="source "><span class="base_path">test / child / </span><span class="file_name">child.js</span></a><a href="../../../test/client-childProccess.js.html" class="source "><span class="base_path">test / </span><span class="file_name">client-childProccess.js</span></a><a href="../../../test/client-http.js.html" class="source "><span class="base_path">test / </span><span class="file_name">client-http.js</span></a><a href="../../../test/client-tcp.js.html" class="source "><span class="base_path">test / </span><span class="file_name">client-tcp.js</span></a><a href="../../../test/client.js.html" class="source "><span class="base_path">test / </span><span class="file_name">client.js</span></a><a href="../../../test/full-stack.js.html" class="source "><span class="base_path">test / </span><span class="file_name">full-stack.js</span></a><a href="../../../test/server-http.js.html" class="source "><span class="base_path">test / </span><span class="file_name">server-http.js</span></a><a href="../../../test/server-tcp.js.html" class="source "><span class="base_path">test / </span><span class="file_name">server-tcp.js</span></a><a href="../../../test/server.js.html" class="source "><span class="base_path">test / </span><span class="file_name">server.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>tcp.js</h1><div class="filepath">lib/transports/shared/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>Take a JSON object and transform it into a <a href="http://en.wikipedia.org/wiki/String_%28computer_science%29#Length-prefixed">Pascal string</a> stored in a buffer.
The length prefix is big-endian because DEATH TO THE LITTLE ENDIAN LILLIPUTIANS!</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Since all messages start with a length prefix and the "current" message is the first in the buffers array,
we can determine the message length just by the first buffer in the array. This technically assumes that
a buffer is at least 4 bytes large, but that should be a safe assumption.</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Simple helper function that returns the minimum value from all values passed into it</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Given an array of buffers, the message length, and the eventEmitter object (in case of error)
try to parse the message and return the object it contains</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Allocate a new buffer the size of the message to copy the buffers into
and keep track of how many bytes have been copied and what buffer we're currently on</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Continue copying until we've hit the message size</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>bytesToCopy contains how much of the buffer we'll copy, either the
"whole thing" or "the rest of the message".</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Since the first buffer contains the message length itself, it's special-cased
to skip those 4 bytes</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Increment the number of bytes copied by how many were copied</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>If we're done, we have some cleanup to do; either appending the final chunk of the buffer
to the next buffer, or making sure that the array slice after the while loop is done
appropriately</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Move on to the next buffer in the array</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Trim the buffers array to the next message</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Parse the buffer we created into a string and then a JSON object, or emit the parsing error</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>jshint loopfunc: true</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Export the public methods</p>
</td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr></tbody></table><div id="generated">generated Sat Dec 28 2013 19:41:38 GMT-0800 (PST)  </div></div></body></html>